<VirtualHost *:443>
    ServerName hydrolink-btp.com
    DocumentRoot /var/www/hyperlink

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/hydrolink-btp.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/hydrolink-btp.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf

    # Enable RewriteEngine
    RewriteEngine On

    # Handle API requests - proxy to Laravel backend
    RewriteCond %{REQUEST_URI} ^/api/(.*)$
    RewriteRule ^/api/(.*)$ /var/www/hyperlink/hydrolinkbacken/public/index.php [L]

    # Handle storage files - serve from Laravel
    RewriteCond %{REQUEST_URI} ^/storage/(.*)$
    RewriteRule ^/storage/(.*)$ /var/www/hyperlink/hydrolinkbacken/storage/app/public/$1 [L]

    # Everything else - proxy to Next.js on port 3035
    RewriteCond %{REQUEST_URhttps://github.com/Mounkaila144/hyperlink.gitI} !^/api/
    RewriteCond %{REQUEST_URI} !^/storage/
    RewriteRule ^/(.*)$ http://localhost:3035/$1 [P,L]

    # Enable proxy modules
    ProxyRequests Off
    ProxyPreserveHost On
    ProxyPassReverse / http://localhost:3035/

    # Laravel backend directory configuration
    <Directory /var/www/hyperlink/hydrolinkbacken/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php
    </Directory>

    # Storage directory configuration
    Alias /storage /var/www/hyperlink/hydrolinkbacken/storage/app/public
    <Directory /var/www/hyperlink/hydrolinkbacken/storage/app/public>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/hydrolink-error.log
    CustomLog ${APACHE_LOG_DIR}/hydrolink-access.log combined
</VirtualHost>

# Redirection HTTP vers HTTPS
<VirtualHost *:80>
    ServerName hydrolink-btp.com
    Redirect permanent / https://hydrolink-btp.com/
</VirtualHost>
